.page
  .page-content

    -if current_user && admin_of_current_account?
      = render :partial => 'layouts/application/admin_bar'

      - if @courses_yesterday.present?
        .notification-center
          %br
          .class-section-heading Teachers we need to pay
          %table
            - @courses_yesterday.each do |course|  
              - next if course.price == 0
              %tr
                %td= course.id
                %td= course.title
                %td= course.teacher.email
                %td= "$ #{course.price * course.students.size}"

      %div
        .heading15#marcomm Goals for April 2012
        %br
        .bigNum 75 Classes
        = "#{@courses_this_month} to date"
  
      / %br
      / %div
      /   .heading15#marcomm Last 7 days
      /   - @users.first(7).each do |date, count|
      /     = "#{date}: #{count} new users & #{@courses[date]||0} new courses & #{@students[date] ||0} new students"
      /     %br

      %br
      %div
        .heading15#marcomm Next 7 days
        %table.metrics
          %tr
            %th= "Title"
            %th= "Date"
            %th= "Min #"
            %th= "Current #"
          - @courses_next7days.each do |course|
            %tr
              %td.metrics-course-title= link_to course.title, course
              %td.metrics= course.starts_at
              %td.metrics-seats= course.min_seats
              %td.metrics-seats= course.students.size

        / %hr
        / %div
        /   %h2 Teachers' emails
        /   - @teachers.each do |teacher|
        /     %p
        /       = "#{teacher.name} - #{teacher.email}"

.sidebar
  .sidebar-content
    .heading15#marcomm Month over month
    - @users_by_month.each do |month, count|
      = "#{Date::MONTHNAMES[month.last.to_i]}:"
      = "#{ @users_by_month[month] || 0 } U & #{@courses_by_month[month] ||0} C & #{number_to_currency @transaction_by_month[month] || 0, :precision => 0 }"
      %br
      
    %br    
    .heading15#marcomm Total To Date
    %table
      %tr
        %td= "Total Users:" 
        %td= "#{@total_users} (#{number_to_percentage(@total_fb_users/@total_users.to_f * 100, :precision => 0)} FB)"
      %tr
        %td= "Active Users:"
        %td= "#{@total_active_users} (#{number_to_percentage(@total_active_users/@total_users.to_f * 100, :precision => 0)})"
      %tr
        %td= "Active Students:"
        %td= "#{@total_active_students} (#{number_to_percentage(@total_active_students/@total_users.to_f * 100, :precision => 0)})"
      %tr
        %td= "Active Teachers:"
        %td= "#{@total_active_teachers} (#{number_to_percentage(@total_active_teachers/@total_users.to_f * 100, :precision => 0)})"
      %tr
        %td= "Repeat Users:"
        %td= "#{@total_repeat_users} (#{number_to_percentage(@total_repeat_users/@total_active_users.to_f * 100, :precision => 0)})"
      %tr
        %td= "Repeat Students:"
        %td= "#{@total_repeat_students} (#{number_to_percentage(@total_repeat_students/@total_active_students.to_f * 100, :precision => 0)})"
      %tr.metrics_underline
        %td= "Repeat Teachers:"
        %td= "#{@total_repeat_teachers} (#{number_to_percentage(@total_repeat_teachers/@total_active_teachers.to_f * 100, :precision => 0)})"
      %tr
        %td= "Total Courses:" 
        %td= "#{@total_courses}"
      %tr
        %td= "Paying Courses:" 
        %td= "#{@paying_courses} (#{number_to_percentage(@paying_courses/@total_courses.to_f * 100, :precision => 0)})"    
      %tr
        %td= "Free Courses:" 
        %td= "#{@free_courses} (#{number_to_percentage(@free_courses/@total_courses.to_f * 100, :precision => 0)})"
      %tr.metrics_underline
        %td= "Happened Courses:" 
        %td= "#{@happened_courses} (#{number_to_percentage(@happened_courses/@total_courses.to_f * 100, :precision => 0)})"
      %tr
        %td= "Total Transactions:" 
        %td= "#{ number_to_currency @total_transaction}"
      %tr
        %td= "Revenue:" 
        %td= "#{ number_to_currency @total_transaction - @amazon_fees - @teachers_share}"
        


