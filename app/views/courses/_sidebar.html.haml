.sidebar-white
  .sidebar-content-white
    = "Class min. of #{course.min_seats}"
    - if course.max_seats.present?
      = ", max. of #{course.max_seats}"
    %br
    %br
    %div.user_status
      = content_tag(:p, "You are teaching this class!")       if course.has_teacher?(current_user)
      = content_tag(:p, "You're registered for this course!") if course.has_student?(current_user)
    %div.course_status
      = content_tag(:p, "This class is full!")                if course.sold_out?
      = content_tag(:p, "This class has passed.")             if course.inactive?
      = content_tag(:p, "This class is not in your city!")    unless course.near_user?(current_user)
    %div.course_action
      - if can? :sign_up_for_course, course
        - if course.sold_out? || course.inactive?
          = button_to "Request a new one",       new_suggestion_path,  :class => "register-class-button", :method => :get
        - elsif course.donate?
          = button_to " ",                       payment_preview_path, :class => "greendoorsRegister #{'tooFarToRegister' unless course.near_user?(current_user) }"
        - else
          = button_to "Register for this class", payment_preview_path, :class => "register-class-button #{'tooFarToRegister' unless course.near_user?(current_user) }"

      - if can? :edit_course, course
        - if course.inactive?
          = button_to "Teach this again!",       new_course_path, :method => :get, :class => "register-class-button"
        - else
          = button_to "Edit class profile",      edit_course_path, :method => :get, :class => "edit-class-button"
          =# button_to "Cancel this Class",       edit_course_path, :method => :get, :class => "edit-class-button"


    //todo move this out of tables and move the glyphs (pricetag, icon_calendar, etc.) to css
    .sidebar-block
      %table
        %tr
          %td.icon
            = image_tag "v2/icon_pricetag.png", :class => "class-details-icon-cost"
          %td
            .class-details
              = "$" "#{course.price}"
              %br/
              - if course.has_student?(current_user)
              - else
                - if course.donate?
                  .greendoors-alternatives All proceeds will be used to support the Peer Teaching Fund!
                - else
                  %a.class-alternatives(href="http://bit.ly/rAtf6o") Too much? Suggest a new price!
              %br
        %tr
          %td.icon
            = image_tag "v2/icon_calendar.png", :class => "class-details-icon-when"
          %td
            .class-details
              = course.date.strftime("%a %b %d, %Y")
            .class-sidebar-details
              = "#{course.time_range}"
              %br
            - if course.has_student?(current_user)

            - else
              %a.class-alternatives(href="http://bit.ly/rAtf6o") Can't make it? Request a new time!
              %br/
        %tr
          %td.icon
            = image_tag "v2/icon_location.png", :class => "class-details-icon-where"
          %td
            .class-details
              = course.place_name
            - if course.public?
              .class-sidebar-details
                = course.address
            - else
              = "Private Address"
            - if course.has_student?(current_user)
            - else
              %a.class-alternatives(href="http://bit.ly/rAtf6o") Don't live in this city? Request in yours!
              %br

    - if course.donate?
      .sidebar-block
        = image_tag "v2-campaign/frame.png", :class => "greendoors-frame"
        = link_to image_tag("v2-campaign/button-learnmore.png"), campaign_path, :class => "button-learnmore"
        .greendoors-frame-heading Peer Teaching Fund
        .greendoors-frame-copy
          .greendoors-frame-copy-text This fund is used to cover the cost of a peer teaching program at our partnered non-profit organizations.  


    .sidebar-block-last
      .sidebar-heading Teacher
      .class-attendance-block
        - if course.teacher.photo.present?
          = image_tag(course.teacher.photo.url(:thumb_small))
        - else
          = image_tag "v2/Avatars_04_V1.png", :class => "avatar-medium"
        .class-details
          %a.profile-link
          = link_to "#{course.teacher.name}", course.teacher, :class => "profile-link"
        %p.class-details
          - if course.experience.blank?
            = "#{course.teacher.bio}"
          - else
            = course.experience

      - if course.teacher != current_user
        = image_tag "v2/icon_email.png", :class => "class-details-icon-email"
        = link_to "Contact teacher", contact_teacher_path(:id => course), :class => "contact-link"


    - if course.students.any?
      .sidebar-block-last
        - if course.nosignup.blank?
          .sidebar-heading Students
        - else course.nosignup?
          .sidebar-heading People interested
        .class-attendance-block
          - course.students.each do |student|
            %table
              %tr
                %td
                  = avatar_for(student, :photo_size => :thumb_small, :class => 'notBig', :size => '50x50')
                %td
                  = link_to student.name, student, :class => "profile-link"
            %br

        - if course.has_teacher?(current_user)
          = image_tag "v2/icon_email.png", :class => "class-details-icon-email"
          = link_to "Contact students", contact_all_students_path(:id => course), :class => "contact-link"


// Feedback link on the admin bar
- content_for :admin_action do
  = link_to "Feedback form", feedback_path(:id => course)


// Modal Layout for when a User tries to sign up for a course too far away
= render :layout => 'shared/page/modal', :locals => {:modal_class => 'tooFarToRegisterModal'} do
  = content_tag(:p, "Wait!! This class is in #{course.city.try(:name_state)}, which  we think is kinda far away from #{current_user.try(:location)}.")
  %p
    = "If you're no longer in #{current_user.try(:location)} "
    = link_to "change your location here", edit_user_registration_path(:id => current_user)
    = ", or continue signing up for this class"

  %div
    %br
    = button_to "Signup", payment_preview_path(:id => course.to_params), :class => "register-class-button"



// Show the modal window if a person tries to register for a course too far away from them
:javascript
  $(document).ready( function(){
    $('.tooFarToRegister').bind('click', function(){
      $('.tooFarToRegisterModal').show();
      return false;
    })
  });

